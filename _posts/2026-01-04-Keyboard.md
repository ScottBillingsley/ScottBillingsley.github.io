## Matrix Keyboard

My first version of the CHIP8 emulator had the matrix keyboard
connected directly to the ARVduino. But to get the higher 
video resolution, I need more pins. So I decided to move the 
keyboard to the data bus.

![]({{site.baseurl}}/images/chip8/keyboard concept.png)

I use an AVR128DB28 to scan the matrix keyboard. If a key is 
pressed, it checks the ACK line to see if any other peripheral
is being serviced. If ACK is low, it then waits for the H_sync
to go high then low again thus starting at the begining of the
pixel clock. It then triggers an interrupt and waits for the
ACK line to go high. It then sets it's data port as output and
places the key value on the data bus. Once the ACK line goes
low, it sets it's data bus to input and returns to scaning the
keys.

![]({{site.baseurl}}/images/chip8/Keyboard Timing.png)

Here is a schematic showing the keyboard connections to the
AVR128DB28.

![]({{site.baseurl}}/images/chip8/Keyboard Schematic.png)

The keyboard only uses 5 data lines. 0 to 3 hold the key 
number, 0x00 to 0x0F, and the 4th is either 0 for key off 
or 1 for key on.

After a little work with the logic on the receive side, I 
got it to pass the [Timendus](https://github.com/Timendus/chip8-test-suite?tab=readme-ov-file) keyboard test.

## Video Memory

The standard CHIP8 only needs 256 bytes as video memory, ie 8 bytes per line
for 32 lines. So a single 8 bit port is all that in needed to address all 
the bytes in video memory. In order to display the higher resolution of 
128x64 you need 1024 bytes, ie 16 bytes per line for 64 lines. I would
also like to have a text mode screen for a menu system in an os at 128x128, 
25 columns and 18 lines of 5x7 fonts. This will require 2048 bytes. This will
be 11 address lines, the 8 in PORTC already running and 0 to 2 on PORTE.
The video buffer is sent the the video driver in a continuous loop and will
send 4 bytes on each of the fisrt 512 horizontal sync pulses for 60 frames
per second.



